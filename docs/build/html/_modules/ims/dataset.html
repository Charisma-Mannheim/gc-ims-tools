
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ims.dataset &#8212; gc-ims-tools 0.1.7 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/haiku.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>gc-ims-tools 0.1.7 documentation</span></a></h1>
        <h2 class="heading"><span>ims.dataset</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for ims.dataset</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ims</span> <span class="kn">import</span> <span class="n">Spectrum</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">dtwalign</span> <span class="kn">import</span> <span class="n">dtw</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">resample</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ShuffleSplit</span><span class="p">,</span>
    <span class="n">KFold</span><span class="p">,</span>
    <span class="n">StratifiedKFold</span><span class="p">,</span>
    <span class="n">LeaveOneOut</span><span class="p">,</span>
    <span class="n">StratifiedShuffleSplit</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="Dataset"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset">[docs]</a><span class="k">class</span> <span class="nc">Dataset</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dataset class coordinates many GC-IMS spectra</span>
<span class="sd">    (instances of ims.Spectrum class) with labels, file</span>
<span class="sd">    and sample names.</span>

<span class="sd">    ims.Spectrum methods are applied to all spectra. It also contains</span>
<span class="sd">    additional functionality and methods that require multiple spectra</span>
<span class="sd">    at a time such as alignments and calculating means. Most operations</span>
<span class="sd">    are done inplace for memory efficiency.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : list</span>
<span class="sd">        Lists instances of `ims.Spectrum`.</span>

<span class="sd">    name : str</span>
<span class="sd">        Name of the dataset.</span>

<span class="sd">    files : list</span>
<span class="sd">        Lists one file name per spectrum. Must be unique.</span>

<span class="sd">    samples : list</span>
<span class="sd">        Lists sample names. A sample can have multiple files in</span>
<span class="sd">        case of repeat determination. Needed to calculate means.</span>

<span class="sd">    labels : list or numpy.ndarray</span>
<span class="sd">        Classification or regression labels.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    preprocessing : list</span>
<span class="sd">        Keeps track of applied preprocessing steps.</span>

<span class="sd">    weights : numpy.ndarray of shape (n_samples, n_features)</span>
<span class="sd">        Stores the weights from scaling when the method is called.</span>
<span class="sd">        Needed to correct the loadings in PCA automatically.</span>

<span class="sd">    train_index : list</span>
<span class="sd">        Keeps the indices from train_test_split method.</span>
<span class="sd">        Used for plot annotations in PLS_DA and PLSR classes.</span>

<span class="sd">    test_index : list</span>
<span class="sd">        Keeps the indices from train_test_split method.</span>
<span class="sd">        Used for plot annotations in PLS_DA and PLSR classes.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; import ims</span>
<span class="sd">    &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">    &gt;&gt;&gt; print(ds)</span>
<span class="sd">    Dataset: IMS_data, 58 Spectra</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Dataset: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2"> Spectra&quot;</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Dataset</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Dataset</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">key</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">key</span><span class="p">],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">key</span><span class="p">],</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">key</span><span class="p">],</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Concatenates two ims.Datasets instances&quot;&quot;&quot;</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">other</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">files</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">preprocessing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">preprocessing</span>
        <span class="k">return</span> <span class="n">ds</span>

<div class="viewcode-block" id="Dataset.copy"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses deepcopy from the copy module in the standard library.</span>
<span class="sd">        Most operations happen inplace. Use this method if you do not</span>
<span class="sd">        want to change the original variable.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">            deepcopy of self.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; new_variable = ds.copy()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">timestamps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Property of timestamps when each spectrum in dataset was recorded.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of Python datetime objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">spectrum</span><span class="o">.</span><span class="n">time</span> <span class="k">for</span> <span class="n">spectrum</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sample_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This property returns information about all spectra indices</span>
<span class="sd">        for each sample in the dataset.</span>
<span class="sd">        Useful to select or remove specific samples or files.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Sample names as keys, lists with indices of spectra as values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">u_samples</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">)</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">u_samples</span><span class="p">,</span> <span class="n">indices</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">indices</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_measurements</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">subfolders</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lists paths to every file in folder.</span>
<span class="sd">        Optionally generates label and sample names by splitting file paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">subfolders</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/*/*/*&quot;</span><span class="p">)]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">filedir</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filedir</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
                <span class="n">sample_name</span> <span class="o">=</span> <span class="n">filedir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_name</span><span class="p">)</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">filedir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/*&quot;</span><span class="p">)]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

<div class="viewcode-block" id="Dataset.read_mea"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.read_mea">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_mea</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">subfolders</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads all mea files from G.A.S Dortmund instruments in the</span>
<span class="sd">        given directory and combines them into a dataset.</span>
<span class="sd">        Much faster than reading csv files and therefore preferred.</span>

<span class="sd">        If subfolders=True expects the following folder structure</span>
<span class="sd">        for each label and sample:</span>

<span class="sd">        * Data</span>
<span class="sd">            * Group A</span>
<span class="sd">                * Sample A</span>
<span class="sd">                    * file a</span>
<span class="sd">                    * file b</span>
<span class="sd">                * Sample B</span>
<span class="sd">                    * file a</span>
<span class="sd">                    * file b</span>

<span class="sd">        Labels can then be auto-generated from directory names.</span>
<span class="sd">        Otherwise labels and sample names need to be added from other sources</span>
<span class="sd">        for all methods to work.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Absolute or relative file path.</span>

<span class="sd">        subfolders : bool, optional</span>
<span class="sd">            Uses subdirectory names as labels,</span>
<span class="sd">            by default False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;, subfolders=True)</span>
<span class="sd">        &gt;&gt;&gt; print(ds)</span>
<span class="sd">        Dataset: IMS_data, 58 Spectra</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paths</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">_measurements</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">subfolders</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Spectrum</span><span class="o">.</span><span class="n">read_mea</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dataset.read_zip"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.read_zip">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_zip</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">subfolders</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads zipped csv and json files from G.A.S Dortmund mea2zip converting tool.</span>
<span class="sd">        Present for backwards compatibility. Reading mea files is much faster and saves</span>
<span class="sd">        the manual extra step of converting.</span>

<span class="sd">        If subfolders=True expects the following folder structure</span>
<span class="sd">        for each label and sample:</span>

<span class="sd">        * Data</span>
<span class="sd">            * Group A</span>
<span class="sd">                * Sample A</span>
<span class="sd">                    * file a</span>
<span class="sd">                    * file b</span>
<span class="sd">                * Sample B</span>
<span class="sd">                    * file a</span>
<span class="sd">                    * file b</span>

<span class="sd">        Labels can then be auto-generated from directory names.</span>
<span class="sd">        Otherwise labels and sample names need to be added from other sources</span>
<span class="sd">        for all methods to work.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Absolute or relative file path.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_zip(&quot;IMS_data&quot;, subfolders=True)</span>
<span class="sd">        &gt;&gt;&gt; print(ds)</span>
<span class="sd">        Dataset: IMS_data, 58 Spectra</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paths</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">_measurements</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">subfolders</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Spectrum</span><span class="o">.</span><span class="n">read_zip</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dataset.read_csv"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.read_csv">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_csv</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">subfolders</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads generic csv files. The first row must be</span>
<span class="sd">        the drift time values and the first column must be</span>
<span class="sd">        the retention time values. Values inbetween are the</span>
<span class="sd">        intensity matrix.</span>
<span class="sd">        Uses the time when the file was created as timestamp.</span>

<span class="sd">        If subfolders=True expects the following folder structure</span>
<span class="sd">        for each label and sample:</span>

<span class="sd">        * Data</span>
<span class="sd">            * Group A</span>
<span class="sd">                * Sample A</span>
<span class="sd">                    * file a</span>
<span class="sd">                    * file b</span>
<span class="sd">                * Sample B</span>
<span class="sd">                    * file a</span>
<span class="sd">                    * file b</span>

<span class="sd">        Labels can then be auto-generated from directory names.</span>
<span class="sd">        Otherwise labels and sample names need to be added from other sources</span>
<span class="sd">        for all methods to work.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Absolute or relative file path.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_csv(&quot;IMS_data&quot;, subfolders=True)</span>
<span class="sd">        &gt;&gt;&gt; print(ds)</span>
<span class="sd">        Dataset: IMS_data, 58 Spectra</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paths</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">_measurements</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">subfolders</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Spectrum</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dataset.read_hdf5"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.read_hdf5">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">read_hdf5</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads hdf5 files exported by the Dataset.to_hdf5 method.</span>
<span class="sd">        Convenient way to store preprocessed spectra.</span>
<span class="sd">        Especially useful for larger datasets as preprocessing</span>
<span class="sd">        requires more time.</span>
<span class="sd">        Preferred to csv because of faster read and write speeds.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Absolute or relative file path.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; sample = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; sample.to_hdf5(&quot;IMS_data_hdf5&quot;)</span>
<span class="sd">        &gt;&gt;&gt; sample = ims.Dataset.read_hdf5(&quot;IMS_data_hdf5&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;dataset&quot;</span><span class="p">][</span><span class="s2">&quot;labels&quot;</span><span class="p">]]</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;dataset&quot;</span><span class="p">][</span><span class="s2">&quot;samples&quot;</span><span class="p">]]</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;dataset&quot;</span><span class="p">][</span><span class="s2">&quot;files&quot;</span><span class="p">]]</span>
            <span class="n">preprocessing</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;dataset&quot;</span><span class="p">][</span><span class="s2">&quot;preprocessing&quot;</span><span class="p">]]</span>

            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;dataset&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;values&quot;</span><span class="p">])</span>
                <span class="n">ret_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;ret_time&quot;</span><span class="p">])</span>
                <span class="n">drift_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;drift_time&quot;</span><span class="p">])</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                <span class="n">time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
                <span class="n">drift_time_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;drift_time_label&quot;</span><span class="p">])</span>
                <span class="n">spectrum</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">ret_time</span><span class="p">,</span> <span class="n">drift_time</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
                <span class="n">spectrum</span><span class="o">.</span><span class="n">_drift_time_label</span> <span class="o">=</span> <span class="n">drift_time_label</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Test.hdf5&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">preprocessing</span> <span class="o">=</span> <span class="n">preprocessing</span>
        <span class="k">return</span> <span class="n">dataset</span></div>

<div class="viewcode-block" id="Dataset.to_hdf5"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.to_hdf5">[docs]</a>    <span class="k">def</span> <span class="nf">to_hdf5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports the dataset as hdf5 file.</span>
<span class="sd">        It contains one group per spectrum and one with labels etc.</span>
<span class="sd">        Use ims.Dataset.read_hdf5 to read the file and construct a dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            Name of the hdf5 file. File extension is not needed.</span>
<span class="sd">            If not set, uses the dataset name attribute,</span>
<span class="sd">            by default None.</span>

<span class="sd">        path : str, otional</span>
<span class="sd">            Path to save the file. If not set uses the current working</span>
<span class="sd">            directory, by default None.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; ds.to_hdf5()</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_hdf5(&quot;IMS_data.hdf5&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.hdf5&quot;</span><span class="p">,</span> <span class="s2">&quot;w-&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;dataset&quot;</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;samples&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;preprocessing&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">grp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">name</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;values&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;ret_time&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">ret_time</span><span class="p">)</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;drift_time&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sample</span><span class="o">.</span><span class="n">drift_time</span><span class="p">)</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;drift_time_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">_drift_time_label</span></div>

<div class="viewcode-block" id="Dataset.select"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects all spectra of specified label or sample.</span>
<span class="sd">        Must set at least one of the parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : str, optional</span>
<span class="sd">            Label name to keep, by default None</span>

<span class="sd">        sample : str, optional</span>
<span class="sd">            Sample name to keep, by default None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">            Contains only matching spectra.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; group_a = ds.select(label=&quot;GroupA&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sample</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must give either label or sample value.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">label</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">label</span><span class="p">:</span>
                    <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">sample</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">sample</span><span class="p">:</span>
                    <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">Dataset</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
            <span class="n">samples</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Dataset.drop"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.drop">[docs]</a>    <span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes all spectra of specified label or sample from dataset.</span>
<span class="sd">        Must set at least one of the parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : str, optional</span>
<span class="sd">            Label name to keep, by default None</span>

<span class="sd">        sample : str, optional</span>
<span class="sd">            Sample name to keep, by default None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">            Contains only matching spectra.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; ds = ds.drop(label=&quot;GroupA&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sample</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must give either label or sample value.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">label</span><span class="p">:</span>
                    <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sample</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">sample</span><span class="p">:</span>
                    <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">Dataset</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">result</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
            <span class="n">samples</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Dataset.add_spectrum"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.add_spectrum">[docs]</a>    <span class="k">def</span> <span class="nf">add_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a ims.Spectrum to the dataset.</span>
<span class="sd">        Sample name and label must be provided because they are</span>
<span class="sd">        not stored in the ims.Spectrum class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        spectrum : ims.Spectrum</span>
<span class="sd">            GC-IMS spectrum to add to the dataset.</span>

<span class="sd">        sample : str</span>
<span class="sd">            The sample name is added to the sample attribute.</span>
<span class="sd">            Necessary because sample names are not stored in ims.Spectrum class.</span>

<span class="sd">        label : various</span>
<span class="sd">            Classification or regression label is added to the label attribute.</span>
<span class="sd">            Necessary because labels are not stored in ims.Spectrum class.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">            With Spectrum added.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; sample = ims.Spectrum.read_mea(&quot;sample.mea&quot;)</span>
<span class="sd">        &gt;&gt;&gt; ds.add_spectrum(sample, &quot;sample_name&quot;, &quot;class_label&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spectrum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Dataset.groupby"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.groupby">[docs]</a>    <span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Groups dataset by label or sample.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str, optional</span>
<span class="sd">            &quot;label&quot; or &quot;sample&quot; are valid keys, by default &quot;label&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of one ims.Dataset instance per group or sample.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;label&quot;</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;sample&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only &quot;label&quot; or &quot;sample&quot; are valid keys!&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">group</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;sample&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Dataset.plot"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the spectrum of selected index and adds the label to the title.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int, optional</span>
<span class="sd">            Index of spectrum to plot, by default 0</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes._subplots.AxesSubplot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Dataset.train_test_split"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.train_test_split">[docs]</a>    <span class="k">def</span> <span class="nf">train_test_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Splits the dataset in train and test sets.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        test_size : float, optional</span>
<span class="sd">            Proportion of the dataset to be used for validation.</span>
<span class="sd">            Should be between 0.0 and 1.0,</span>
<span class="sd">            by default 0.2</span>

<span class="sd">        stratify : bool, optional</span>
<span class="sd">            Wheter to stratify output or not.</span>
<span class="sd">            Preserves the percentage of samples from each class in each split,</span>
<span class="sd">            by default False.</span>

<span class="sd">        random_state : int, optional</span>
<span class="sd">            Controls the randomness. Pass an int for reproducible output,</span>
<span class="sd">            by default 1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple of numpy.ndarray</span>
<span class="sd">            X_train, X_test, y_train, y_test</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_Data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; X_train, X_test, y_train, y_test = ds.train_test_split()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">stratify</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">StratifiedShuffleSplit</span><span class="p">(</span>
                <span class="n">n_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
            <span class="p">)</span>
            <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">ShuffleSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
            <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

        <span class="c1"># set attributes for annotations of plots with sample names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_index</span> <span class="o">=</span> <span class="n">train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_index</span> <span class="o">=</span> <span class="n">test</span>

        <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">train</span><span class="p">]</span><span class="o">.</span><span class="n">get_xy</span><span class="p">()</span>
        <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">test</span><span class="p">]</span><span class="o">.</span><span class="n">get_xy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span></div>

<div class="viewcode-block" id="Dataset.kfold_split"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.kfold_split">[docs]</a>    <span class="k">def</span> <span class="nf">kfold_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        K-Folds cross-validator (sklearn.model_selection.KFold).</span>
<span class="sd">        Splits the dataset into k consecutive folds and provides</span>
<span class="sd">        train and test data.</span>

<span class="sd">        If stratify is True uses StratifiedKfold instead.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_splits : int, optional</span>
<span class="sd">            Number of folds. Must be at least 2,</span>
<span class="sd">            by default 5.</span>

<span class="sd">        shuffle : bool, optional</span>
<span class="sd">            Whether to shuffle the data before splitting,</span>
<span class="sd">            by default True.</span>

<span class="sd">        random_state : int, optional</span>
<span class="sd">            When shuffle is True random_state affects the order of the indices.</span>
<span class="sd">            Pass an int for reproducible splits,</span>
<span class="sd">            by default None.</span>

<span class="sd">        stratify : bool, optional</span>
<span class="sd">            Wheter to stratify output or not.</span>
<span class="sd">            Preserves the percentage of samples from each class in each split,</span>
<span class="sd">            by default False.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        tuple</span>
<span class="sd">            (X_train, X_test, y_train, y_test) per iteration</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.metrics import accuracy_score</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; model = ims.PLS_DA(ds)</span>
<span class="sd">        &gt;&gt;&gt; accuracy = []</span>
<span class="sd">        &gt;&gt;&gt; for X_train, X_test, y_train, y_test in ds.kfold_split():</span>
<span class="sd">        &gt;&gt;&gt;     model.fit(X_train, y_train)</span>
<span class="sd">        &gt;&gt;&gt;     y_pred = model.predict(X_test)</span>
<span class="sd">        &gt;&gt;&gt;     accuracy.append(accuracy_score(y_test, y_pred))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stratify</span><span class="p">:</span>
            <span class="n">kf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span>
                <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="n">shuffle</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="n">shuffle</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">):</span>
            <span class="n">train_data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>
            <span class="n">test_data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
            <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">get_xy</span><span class="p">()</span>
            <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">get_xy</span><span class="p">()</span>
            <span class="k">yield</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span></div>

<div class="viewcode-block" id="Dataset.shuffle_split"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.shuffle_split">[docs]</a>    <span class="k">def</span> <span class="nf">shuffle_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shuffled splits for montecarlo cross-validation. Randomly selects</span>
<span class="sd">        a fraction of the dataset, without replacements, per split</span>
<span class="sd">        (sklearn.model_selection.ShuffleSplit).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_splits : int, optional</span>
<span class="sd">            Number of re-shuffling and splitting iterations,</span>
<span class="sd">            by default 5.</span>

<span class="sd">        test_size : float, optional</span>
<span class="sd">            Proportion of the dataset to include in the test split,</span>
<span class="sd">            by default 0.2.</span>

<span class="sd">        random_state : int, optional</span>
<span class="sd">            Controls randomness. Pass an int for reproducible output,</span>
<span class="sd">            by default None.</span>

<span class="sd">        Yields</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            (X_train, X_test, y_train, y_test) per iteration</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.metrics import accuracy_score</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; model = ims.PLS_DA(ds)</span>
<span class="sd">        &gt;&gt;&gt; accuracy = []</span>
<span class="sd">        &gt;&gt;&gt; for X_train, X_test, y_train, y_test in ds.shuffle_split():</span>
<span class="sd">        &gt;&gt;&gt;     model.fit(X_train, y_train)</span>
<span class="sd">        &gt;&gt;&gt;     y_pred = model.predict(X_test)</span>
<span class="sd">        &gt;&gt;&gt;     accuracy.append(accuracy_score(y_test, y_pred))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">ShuffleSplit</span><span class="p">(</span>
            <span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">rs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">):</span>
            <span class="n">train_data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>
            <span class="n">test_data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
            <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">get_xy</span><span class="p">()</span>
            <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">get_xy</span><span class="p">()</span>
            <span class="k">yield</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span></div>

<div class="viewcode-block" id="Dataset.bootstrap"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.bootstrap">[docs]</a>    <span class="k">def</span> <span class="nf">bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_bootstraps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iteratively resamples dataset with replacement. Samples can</span>
<span class="sd">        be included multiple times or not at all in the training data.</span>
<span class="sd">        Uses all samples that are not present in the training data as test data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n_bootstraps : int, optional</span>
<span class="sd">            Number of iterations, by default 5.</span>

<span class="sd">        n_samples : int, optional</span>
<span class="sd">            Number of samples to draw per iteration. Is set to</span>
<span class="sd">            the lenghth of the dataset if None,</span>
<span class="sd">            by default None.</span>

<span class="sd">        random_state : int, optional</span>
<span class="sd">            Controls randomness, pass an int for reproducible output,</span>
<span class="sd">            by default None.</span>

<span class="sd">        Yields</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            (X_train, X_test, y_train, y_test) per iteration</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.metrics import accuracy_score</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; model = ims.PLS_DA(ds)</span>
<span class="sd">        &gt;&gt;&gt; accuracy = []</span>
<span class="sd">        &gt;&gt;&gt; for X_train, X_test, y_train, y_test in ds.bootstrap():</span>
<span class="sd">        &gt;&gt;&gt;     model.fit(X_train, y_train)</span>
<span class="sd">        &gt;&gt;&gt;     y_pred = model.predict(X_test)</span>
<span class="sd">        &gt;&gt;&gt;     accuracy.append(accuracy_score(y_test, y_pred))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bootstraps</span><span class="p">):</span>
            <span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
            <span class="p">)</span>

            <span class="n">test_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">test_labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">train_data</span><span class="p">:</span>
                    <span class="n">test_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">test_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">train_labels</span><span class="p">)</span><span class="o">.</span><span class="n">get_xy</span><span class="p">()</span>
            <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">test_labels</span><span class="p">)</span><span class="o">.</span><span class="n">get_xy</span><span class="p">()</span>
            <span class="k">yield</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span></div>

<div class="viewcode-block" id="Dataset.leave_one_out"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.leave_one_out">[docs]</a>    <span class="k">def</span> <span class="nf">leave_one_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Leave-One-Out cross-validator.</span>
<span class="sd">        Provides train test splits and uses each sample once as test set</span>
<span class="sd">        while the remaining data is used for training.</span>

<span class="sd">        Yields</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            X_train, X_test, y_train, y_test</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.metrics import accuracy_score</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; model = ims.PLS_DA(ds)</span>
<span class="sd">        &gt;&gt;&gt; accuracy = []</span>
<span class="sd">        &gt;&gt;&gt; for X_train, X_test, y_train, y_test in ds.leave_one_out():</span>
<span class="sd">        &gt;&gt;&gt;     model.fit(X_train, y_train)</span>
<span class="sd">        &gt;&gt;&gt;     y_pred = model.predict(X_test, y_test)</span>
<span class="sd">        &gt;&gt;&gt;     accuracy.append(accuracy_score(y_test, y_pred))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">loo</span> <span class="o">=</span> <span class="n">LeaveOneOut</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">loo</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">train_data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>
            <span class="n">test_data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
            <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">get_xy</span><span class="p">()</span>
            <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">get_xy</span><span class="p">()</span>
            <span class="k">yield</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span></div>

<div class="viewcode-block" id="Dataset.mean"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.mean">[docs]</a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates means for each sample, in case of repeat determinations.</span>
<span class="sd">        Automatically determines which file belongs to which sample.</span>
<span class="sd">        Sample names are used for mean spectra and file names are no longer needed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">            With mean spectra.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_indices</span>
        <span class="n">u_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">)</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">grouped_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">u_samples</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">grouped_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">means</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">grouped_data</span><span class="p">:</span>
            <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">u_samples</span><span class="p">):</span>
            <span class="n">i</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">j</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">means</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">u_samples</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;mean()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Dataset.asymcorr"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.asymcorr">[docs]</a>    <span class="k">def</span> <span class="nf">asymcorr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">1e7</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">niter</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retention time baseline correction using asymmetric least squares.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lam : float, optional</span>
<span class="sd">            Controls smoothness. Larger numbers return smoother curves,</span>
<span class="sd">            by default 1e7</span>

<span class="sd">        p : float, optional</span>
<span class="sd">            Controls asymmetry, by default 1e-3</span>

<span class="sd">        niter : int, optional</span>
<span class="sd">            Number of iterations during optimization,</span>
<span class="sd">            by default 20</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Spectrum</span><span class="o">.</span><span class="n">asymcorr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">niter</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;asymcorr&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Dataset.savgol"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.savgol">[docs]</a>    <span class="k">def</span> <span class="nf">savgol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applys a Savitzky-Golay filter to intensity values.</span>
<span class="sd">        Can be applied in the drift time, retention time or both directions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        window_length : int, optional</span>
<span class="sd">            The length of the filter window, by default 10</span>

<span class="sd">        polyorder : int, optional</span>
<span class="sd">            The order of the polynomial used to fit the samples, by default 2</span>

<span class="sd">        direction : str, optional</span>
<span class="sd">            The direction in which to apply the filter.</span>
<span class="sd">            Can be &#39;drift time&#39;, &#39;retention time&#39; or &#39;both&#39;.</span>
<span class="sd">            By default &#39;both&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Spectrum</span><span class="o">.</span><span class="n">savgol</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">window_length</span><span class="p">,</span> <span class="n">polyorder</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;savgol&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Dataset.tophat"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.tophat">[docs]</a>    <span class="k">def</span> <span class="nf">tophat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies white tophat filter on data matrix as a baseline correction.</span>
<span class="sd">        Size parameter is the diameter of the circular structuring element.</span>
<span class="sd">        (Slow with large size values.)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : int, optional</span>
<span class="sd">            Size of structuring element, by default 15.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Spectrum</span><span class="o">.</span><span class="n">tophat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;tophat&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Dataset.sub_first_rows"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.sub_first_rows">[docs]</a>    <span class="k">def</span> <span class="nf">sub_first_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subtracts first row from every row in spectrum.</span>
<span class="sd">        Effective and simple baseline correction</span>
<span class="sd">        if RIP tailing is a concern but can hide small peaks.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Spectrum</span><span class="o">.</span><span class="n">sub_first_rows</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;sub_first_row&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Dataset.interp_riprel"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.interp_riprel">[docs]</a>    <span class="k">def</span> <span class="nf">interp_riprel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interpolates all spectra to common RIP relative drift time coordinate.</span>
<span class="sd">        Alignment along drift time coordinate.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">            With RIP relative spectra.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dt_riprel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">interp_fn</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">drift_time</span>
            <span class="n">rip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
            <span class="n">rip_ms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="n">rip</span><span class="p">])</span>
            <span class="n">riprel</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">/</span> <span class="n">rip_ms</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">riprel</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
            <span class="n">dt_riprel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">riprel</span><span class="p">)</span>
            <span class="n">interp_fn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dt_riprel</span><span class="p">])</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dt_riprel</span><span class="p">])</span>
        <span class="n">interv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">([(</span><span class="n">i</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dt_riprel</span><span class="p">])</span>
        <span class="n">new_dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">interv</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">interp_fn</span><span class="p">):</span>
            <span class="n">i</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_dt</span><span class="p">)]</span>
            <span class="n">i</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">new_dt</span><span class="p">)</span>
            <span class="n">i</span><span class="o">.</span><span class="n">drift_time</span> <span class="o">=</span> <span class="n">new_dt</span>
            <span class="n">i</span><span class="o">.</span><span class="n">_drift_time_label</span> <span class="o">=</span> <span class="s2">&quot;Drift time RIP relative&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;interp_riprel()&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
    
<div class="viewcode-block" id="Dataset.align_ret_time"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.align_ret_time">[docs]</a>    <span class="k">def</span> <span class="nf">align_ret_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retention time alignment based on dymanic time warping.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reference : str, int or Spectrum, optional</span>
<span class="sd">            Reference intensity values and retention time.</span>
<span class="sd">            If &quot;mean&quot; is used, calculates the mean from all samples in dataset.</span>
<span class="sd">            An integer is used to index the dataset and select a Spectrum.</span>
<span class="sd">            If a Spectrum is given, uses this external sample as reference,</span>
<span class="sd">            by default &quot;mean&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">reference</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
            <span class="n">reference_ret_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">sample</span><span class="o">.</span><span class="n">ret_time</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]),</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_xy</span><span class="p">(</span><span class="n">flatten</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">reference_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">reference_ret_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">reference</span><span class="p">]</span><span class="o">.</span><span class="n">ret_time</span>
            <span class="n">reference_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">reference</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">):</span>
            <span class="n">reference_ret_time</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">ret_time</span>
            <span class="n">reference_values</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="n">values</span>

        <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">dtw</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">reference_values</span><span class="p">)</span>
            <span class="n">warping_path</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">get_warping_path</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;query&quot;</span><span class="p">)</span>
            <span class="n">sample</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">warping_path</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">sample</span><span class="o">.</span><span class="n">ret_time</span> <span class="o">=</span> <span class="n">reference_ret_time</span>
            
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Dataset.rip_scaling"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.rip_scaling">[docs]</a>    <span class="k">def</span> <span class="nf">rip_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scales values relative to global maximum.</span>
<span class="sd">        Can be useful to directly compare spectra from</span>
<span class="sd">        instruments with different sensitivity.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">            With scaled values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Spectrum</span><span class="o">.</span><span class="n">rip_scaling</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;rip_scaling&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Dataset.resample"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.resample">[docs]</a>    <span class="k">def</span> <span class="nf">resample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resamples each spectrum by calculating means of every n rows.</span>
<span class="sd">        If the length of the retention time is not divisible by n</span>
<span class="sd">        it and the data matrix get cropped by the remainder at the long end.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int, optional</span>
<span class="sd">            Number of rows to mean,</span>
<span class="sd">            by default 2.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">            Resampled values.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_Data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(ds[0].shape)</span>
<span class="sd">        (4082, 3150)</span>
<span class="sd">        &gt;&gt;&gt; ds.resample(2)</span>
<span class="sd">        &gt;&gt;&gt; print(ds[0].shape)</span>
<span class="sd">        (2041, 3150)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Spectrum</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;resample(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Dataset.binning"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.binning">[docs]</a>    <span class="k">def</span> <span class="nf">binning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downsamples each spectrum by binning the array with factor n.</span>
<span class="sd">        Similar to Spectrum.resampling but works on both dimensions</span>
<span class="sd">        simultaneously.</span>
<span class="sd">        If the dimensions are not divisible by the binning factor</span>
<span class="sd">        shortens it by the remainder at the long end.</span>
<span class="sd">        Very effective data reduction because a factor n=2 already</span>
<span class="sd">        reduces the number of features to a quarter.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int, optional</span>
<span class="sd">            Binning factor, by default 2.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">            Downsampled data matrix.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_Data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(ds[0].shape)</span>
<span class="sd">        (4082, 3150)</span>
<span class="sd">        &gt;&gt;&gt; ds.binning(2)</span>
<span class="sd">        &gt;&gt;&gt; print(ds[0].shape)</span>
<span class="sd">        (2041, 1575)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Spectrum</span><span class="o">.</span><span class="n">binning</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;binning(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
    
<div class="viewcode-block" id="Dataset.wavecompr"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.wavecompr">[docs]</a>    <span class="k">def</span> <span class="nf">wavecompr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;ret_time&quot;</span><span class="p">,</span> <span class="n">wavelet</span><span class="o">=</span><span class="s2">&quot;db3&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Data reduction by wavelet compression.</span>
<span class="sd">        Can be applied to drift time, retention time or both axis.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        direction : str, optional</span>
<span class="sd">            The direction in which to apply the filter.</span>
<span class="sd">            Can be &#39;drift time&#39;, &#39;retention time&#39; or &#39;both&#39;.</span>
<span class="sd">            By default &#39;ret_time&#39;.</span>

<span class="sd">        wavelet : str, optional</span>
<span class="sd">            Wavelet object or name string,</span>
<span class="sd">            by default &quot;db3&quot;.</span>

<span class="sd">        level : int, optional</span>
<span class="sd">            Decomposition level (must be &gt;= 0),</span>
<span class="sd">            by default 3.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            When direction is neither &#39;ret_time&#39;, &#39;drift_time&#39; or &#39;both&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Spectrum</span><span class="o">.</span><span class="n">wavecompr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">wavelet</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;wavecompr&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Dataset.cut_dt"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.cut_dt">[docs]</a>    <span class="k">def</span> <span class="nf">cut_dt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cuts data along drift time coordinate.</span>
<span class="sd">        Range in between start and stop is kept.</span>
<span class="sd">        If stop is not given uses the end of the array instead.</span>
<span class="sd">        Combination with RIP relative drift time</span>
<span class="sd">        values makes it easier to cut the RIP away and focus</span>
<span class="sd">        on the peak area.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start : int or float</span>
<span class="sd">            Start value on drift time coordinate.</span>

<span class="sd">        stop : int or float, optional</span>
<span class="sd">            Stop value on drift time coordinate.</span>
<span class="sd">            If None uses the end of the array,</span>
<span class="sd">            by default None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">            New drift time range.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(ds[0].shape)</span>
<span class="sd">        (4082, 3150)</span>
<span class="sd">        &gt;&gt;&gt; ds.interp_riprel().cut_dt(1.05, 2)</span>
<span class="sd">        &gt;&gt;&gt; print(ds[0].shape)</span>
<span class="sd">        (4082, 1005)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Spectrum</span><span class="o">.</span><span class="n">cut_dt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cut_dt(</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">stop</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Dataset.cut_rt"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.cut_rt">[docs]</a>    <span class="k">def</span> <span class="nf">cut_rt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cuts data along retention time coordinate.</span>
<span class="sd">        Range in between start and stop is kept.</span>
<span class="sd">        If stop is not given uses the end of the array instead.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start : int or float</span>
<span class="sd">            Start value on retention time coordinate.</span>

<span class="sd">        stop : int or float, optional</span>
<span class="sd">            Stop value on retention time coordinate.</span>
<span class="sd">            If None uses the end of the array,</span>
<span class="sd">            by default None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>
<span class="sd">            New retention time range.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(ds[0].shape)</span>
<span class="sd">        (4082, 3150)</span>
<span class="sd">        &gt;&gt;&gt; sample.cut_rt(80, 500)</span>
<span class="sd">        &gt;&gt;&gt; print(ds[0].shape)</span>
<span class="sd">        (2857, 3150)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">Spectrum</span><span class="o">.</span><span class="n">cut_rt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cut_rt(</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">stop</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Dataset.export_plots"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.export_plots">[docs]</a>    <span class="k">def</span> <span class="nf">export_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a figure per spectrum as image file. See the docs for</span>
<span class="sd">        matplotlib savefig function for supported file formats and kwargs</span>
<span class="sd">        (https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.savefig.html).</span>

<span class="sd">        Creates a new folder for the plots in the current working directory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder_name : str, optional</span>
<span class="sd">            New directory to save the images to.</span>

<span class="sd">        file_format : str, optional</span>
<span class="sd">            See matplotlib savefig docs for information</span>
<span class="sd">            about supported formats,</span>
<span class="sd">            by default &#39;jpeg&#39;</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; ds.export_plots(&quot;IMS_data_plots&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">folder_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">folder_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;_plots&quot;</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder_name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">i</span><span class="o">.</span><span class="n">export_plot</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dataset.get_xy"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.get_xy">[docs]</a>    <span class="k">def</span> <span class="nf">get_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flatten</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns features (X) and labels (y) as numpy arrays.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        flatten : bool, optional</span>
<span class="sd">            Flattens 3D datasets to 2D, by default True</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            (X, y)</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; import ims</span>
<span class="sd">        &gt;&gt;&gt; ds = ims.Dataset.read_mea(&quot;IMS_data&quot;)</span>
<span class="sd">        &gt;&gt;&gt; X, y = ds.get_xy()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">flatten</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dataset.scaling"><a class="viewcode-back" href="../../ims.dataset.html#ims.dataset.Dataset.scaling">[docs]</a>    <span class="k">def</span> <span class="nf">scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;pareto&quot;</span><span class="p">,</span> <span class="n">mean_centering</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scales and mean centeres features according to selected method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        method : str, optional</span>
<span class="sd">            &quot;pareto&quot;, &quot;auto&quot; or &quot;var&quot; are valid,</span>
<span class="sd">            by default &quot;pareto&quot;.</span>

<span class="sd">        mean_centering : bool, optional</span>
<span class="sd">            If true center the data before scaling,</span>
<span class="sd">            by default True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If scaling method is not supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;pareto&quot;</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;var&quot;</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> is not a supported method!&quot;</span><span class="p">)</span>

        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">posinf</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">neginf</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mean_centering</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">*</span> <span class="n">weights</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="n">weights</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
            <span class="n">j</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;scaling(</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div></div>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Competency Center for Chemometrics Mannheim.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>